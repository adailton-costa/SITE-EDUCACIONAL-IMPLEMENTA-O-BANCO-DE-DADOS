<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Progresso - EducaUP</title>

<!-- Estilos -->
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    background: #f4f6f8;
    color: #333;
  }

  header {
    background: rgb(30, 58, 69, 1);
    color: #fff;
    text-align: center;
    padding: 20px;
    font-size: 24px;
    font-weight: bold;
  }

  .container {
    max-width: 900px;
    margin: 20px auto;
    padding: 20px;
  }

  /* Cards de cursos */
  .courses-container h3 {
    color: #2a5a8f;
    margin-bottom: 15px;
  }

  .course-cards {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    margin-bottom: 30px;
  }

  .course-card {
    min-width: 200px;
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: 0.3s;
    text-align: center;
  }

  .course-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  }

  .course-card h4 {
    margin: 0;
    color: #2a5a8f;
  }

  .course-card.active {
    border: 2px solid #2a5a8f;
    box-shadow: 0 6px 15px rgba(25, 118, 210, 0.25);
  }

  /* Cards de resumo */
  .cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    text-align: center;
    transition: 0.3s;
  }

  .card:hover {
    transform: translateY(-5px);
  }

  .card h3 {
    font-size: 18px;
    color: #2a5a8f;
    margin-bottom: 10px;
  }

  .card p {
    font-size: 22px;
    font-weight: bold;
    color: #2a5a8f;
  }

  /* Histórico de quizzes */
  .quiz-container {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    margin-bottom: 30px;
  }

  .quiz-container h3 {
    margin-bottom: 10px;
    color: #2a5a8f;
  }

  .quiz-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .quiz-list li {
    padding: 12px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    font-size: 16px;
  }

  .quiz-list li:last-child {
    border-bottom: none;
  }

  .quiz-score {
    font-weight: bold;
    color: #4CAF50;
  }

  /* Botão voltar */
  .btn-voltar {
    display: inline-block;
    margin-top: 20px;
    padding: 10px 20px;
    background-color: rgb(30, 58, 69, 1);
    color: #fff;
    text-decoration: none;
    border-radius: 8px;
    transition: 0.3s;
  }

  .btn-voltar:hover {
    background-color: #027afb;
  }

</style>
</head>
<body>

<header>Meu Progresso - EducaUP</header>

<div class="container">

  <!-- Cursos -->
  <div class="courses-container">
    <h3>Meus Cursos</h3>
    <div class="course-cards" id="courseCards"></div>
  </div>

  <!-- Cards de resumo -->
  <div class="cards">
    <div class="card">
      <h3>Aulas Concluídas</h3>
      <p id="aulasConcluidas">0</p>
    </div>
    <div class="card">
      <h3>Progresso</h3>
      <p id="progresso">0%</p>
    </div>
    <div class="card">
      <h3>Tempo Estudado</h3>
      <p id="tempoTotal">0h 0min</p>
    </div>
    <div class="card">
      <h3>Última Aula</h3>
      <p id="ultimaAula">-</p>
    </div>
  </div>

  <!-- Histórico de Quizzes -->
  <div class="quiz-container">
    <h3>Histórico de Quizzes</h3>
    <ul id="quizHistorico" class="quiz-list"></ul>
  </div>

  <!-- Botão voltar -->
  <a href="pagina-principal.html" class="btn-voltar">← Voltar para Início</a>

</div>

<!-- Firebase + Lógica -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAQ0s0EpWm2kmPAC3z0bNphLyjcGieWIBM",
    authDomain: "siteweb-ca3bc.firebaseapp.com",
    projectId: "siteweb-ca3bc",
    storageBucket: "siteweb-ca3bc.appspot.com",
    messagingSenderId: "312050528441",
    appId: "1:312050528441:web:70abee0173951c08402b68"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let user;

  // Cursos disponíveis
  const cursosDoUsuario = [
    { id: "cursoMatematica", nome: "Matemática" },
    { id: "cursoPortugues", nome: "Português" },
    { id: "cursoHistoria", nome: "História" }
  ];

  function gerarCardsCursos() {
    const container = document.getElementById('courseCards');
    container.innerHTML = '';
    cursosDoUsuario.forEach(curso => {
      const div = document.createElement('div');
      div.classList.add('course-card');
      div.dataset.id = curso.id;
      div.innerHTML = `<h4>${curso.nome}</h4>`;
      div.onclick = () => carregarRelatorio(curso.id);
      container.appendChild(div);
    });
  }

  async function carregarRelatorio(courseId) {
    // Marca card ativo
    document.querySelectorAll('.course-card').forEach(c => c.classList.remove('active'));
    const activeCard = document.querySelector(`.course-card[data-id="${courseId}"]`);
    if(activeCard) activeCard.classList.add('active');

    if(!user) return;

    const ref = doc(db, `users/${user.uid}/courses/${courseId}`);
    const snapshot = await getDoc(ref);

    if (snapshot.exists()) {
      const data = snapshot.data();

      document.getElementById('aulasConcluidas').textContent = data.aulasConcluidas || 0;
      document.getElementById('progresso').textContent = (data.progressoPercentual || 0) + '%';
      document.getElementById('ultimaAula').textContent = data.ultimaAula || '-';

      const horas = Math.floor((data.tempoTotal || 0) / 3600);
      const minutos = Math.floor(((data.tempoTotal || 0) % 3600) / 60);
      document.getElementById('tempoTotal').textContent = `${horas}h ${minutos}min`;

      const quizContainer = document.getElementById('quizHistorico');
      quizContainer.innerHTML = "";
      (data.quizResults || []).forEach(q => {
        const li = document.createElement('li');
        li.innerHTML = `<span>Aula ${q.aula}</span> <span class="quiz-score">${q.acertos}/${q.total}</span>`;
        quizContainer.appendChild(li);
      });
    } else {
      // Curso não implementado ainda ou sem dados
      document.getElementById('aulasConcluidas').textContent = 0;
      document.getElementById('progresso').textContent = '0%';
      document.getElementById('ultimaAula').textContent = '-';
      document.getElementById('tempoTotal').textContent = '0h 0min';
      document.getElementById('quizHistorico').innerHTML = '';
      console.log("Nenhum dado encontrado para este curso.");
    }
  }

  onAuthStateChanged(auth, (u) => {
    if (u) {
      user = u;
      gerarCardsCursos();
      // Carrega curso de Matemática por padrão
      carregarRelatorio("cursoMatematica");
    } else {
      console.log("Usuário não autenticado.");
      alert("Faça login para ver seu progresso.");
    }
  });

</script>
</body>
</html>
